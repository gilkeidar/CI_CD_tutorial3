import FortuneEngine from"../../engine.js";document.addEventListener("DOMContentLoaded",(async()=>{const e=new FortuneEngine("ying_yang_coin");await e.db_reader("yin_yang_coin.json");let n=0,t=0,o=1;const s=e.get_json_contents().hexagrams,i=document.querySelector(".action-button"),l=document.getElementById("music-button"),a=document.getElementById("info-button"),r=document.querySelector(".line-image"),c=document.getElementById("line-text"),d=document.querySelectorAll("#grid"),m=document.querySelector(".content-grid"),y=document.getElementById("instruction-image"),u=document.getElementById("instruction-text"),g=document.getElementById("interpretation-text"),p=document.getElementById("character"),T=document.querySelector(".coin-display"),f=document.getElementsByClassName("coins");let v=!0,E=!1;const b=new Audio("background_music1.mp3"),L=new Audio("coin_flipv3.ogg");b.loop=!0,b.volume=.3,L.volume=.4,b.play(),l.addEventListener("click",(e=>{console.log("music");const n=document.getElementById("music");v?(n.src="../../assets/audio_off.png",b.pause()):(n.src="../../assets/audio_on.png",b.play()),v=!v})),a.addEventListener("click",(e=>{document.getElementById("info-popup").style.display=E?"none":"flex",E=!E})),i.addEventListener("click",(i=>{const l=i.target,a=l.value;switch(console.log(a),a){case"start":l.value="toss",l.innerText="Toss Coins",c.innerText="Record",c.style.fontSize="3rem",y.style.display="none",u.style.display="none",r.style.display="none",T.style.display="block";break;case"toss":const i=e.get_random_subset(1)[0];console.log("coinResult:",i.value),console.log("Power of two:",o),t+=i.value*o,o<<=1,console.log("Hexagram Index:",t),n++,console.log("Tossing coins! tossCounter =",n),console.log(d[n]),"Yin"===i.type?setTimeout((function(){d[n-1].innerHTML+='<img class="animated-line-image" src="broken_line.PNG" alt="instruction image display failed."/>'}),4500):setTimeout((function(){d[n-1].innerHTML+='<img class="animated-line-image" src="solid_line.PNG" alt="instruction image display failed."/>'}),4500);const a=i.coins.toLowerCase(),v=a.slice(0,1),E=a.slice(1,2),b=a.slice(2,3);f[0].style.animation=`${v}-rotate-${n%2} 4.3s ease forwards`,f[1].style.animation=`${E}-rotate-${n%2} 4.3s ease forwards`,f[2].style.animation=`${b}-rotate-${n%2} 4.3s ease forwards`,L.play(),l.style.pointerEvents="none",l.innerText="Tossing Coins...",setTimeout((()=>{l.style.pointerEvents="all",l.innerText="Toss Coins",6===n&&(l.value="result",l.innerText="Get Result")}),5500);break;case"result":const x=s[t];console.log("Hexagram Result:",x),l.value="reset",l.innerText="New Round",p.innerHTML=x.character,u.innerHTML=`"${x.name}"`,g.innerHTML=`"${x.meaning}"`,setTimeout((()=>{p.className="active",2===x.character.length?p.style.marginRight="1%":p.style.marginRight="3%"}),3500),u.style.animation="blurFadeIn 3s ease-in forwards",u.style.fontSize="3rem",u.style.display="block",T.style.display="none",m.style.display="grid",setTimeout((()=>{g.style.display="inline-block"}),7500),l.style.pointerEvents="none",setTimeout((()=>{l.style.pointerEvents="all"}),11e3);break;case"reset":t=0,n=0,o=1,l.value="start",l.innerText="Start";for(const e of f)e.style.animation="none";p.innerHTML="",g.innerHTML="",u.innerHTML="Instruction",c.innerHTML="Side Info",p.className="inactive",u.style.fontSize="2rem",u.style.animation="none",y.style.display="inline-block",g.style.display="none",m.style.display="inline",c.style.fontSize="2rem",r.style.display="inline-block";for(let e=0;e<6;e++)console.log(d[e]),d[e].innerHTML=""}}))}));
