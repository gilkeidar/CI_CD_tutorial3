import FortuneEngine from"../../engine.js";document.addEventListener("DOMContentLoaded",async()=>{const a=new FortuneEngine("ying_yang_coin");await a.db_reader("yin_yang_coin.json");let r=0,c=0,d=1;const m=a.get_json_contents().hexagrams;var e=document.querySelector(".action-button"),n=document.getElementById("music-button"),t=document.getElementById("info-button");const y=document.querySelector(".line-image"),u=document.getElementById("line-text"),g=document.querySelectorAll("#grid"),p=document.querySelector(".content-grid"),T=document.getElementById("instruction-image"),f=document.getElementById("instruction-text"),v=document.getElementById("interpretation-text"),E=document.getElementById("character"),b=document.querySelector(".coin-display"),L=document.getElementsByClassName("coins");let o=!0,s=!1;const i=new Audio("background_music1.mp3"),x=new Audio("coin_flipv3.ogg");i.loop=!0,i.volume=.3,x.volume=.4,i.play(),n.addEventListener("click",e=>{console.log("music");var n=document.getElementById("music");o?(n.src="../../assets/audio_off.png",i.pause()):(n.src="../../assets/audio_on.png",i.play()),o=!o}),t.addEventListener("click",e=>{document.getElementById("info-popup").style.display=s?"none":"flex",s=!s}),e.addEventListener("click",e=>{const n=e.target;e=n.value;switch(console.log(e),e){case"start":n.value="toss",n.innerText="Toss Coins",u.innerText="Record",u.style.fontSize="3rem",T.style.display="none",f.style.display="none",y.style.display="none",b.style.display="block";break;case"toss":var t=a.get_random_subset(1)[0],t=(console.log("coinResult:",t.value),console.log("Power of two:",d),c+=t.value*d,d<<=1,console.log("Hexagram Index:",c),r++,console.log("Tossing coins! tossCounter =",r),console.log(g[r]),"Yin"===t.type?setTimeout(function(){g[r-1].innerHTML+='<img class="animated-line-image" src="broken_line.PNG" alt="instruction image display failed."/>'},4500):setTimeout(function(){g[r-1].innerHTML+='<img class="animated-line-image" src="solid_line.PNG" alt="instruction image display failed."/>'},4500),t.coins.toLowerCase()),o=t.slice(0,1),s=t.slice(1,2),t=t.slice(2,3);L[0].style.animation=`${o}-rotate-${r%2} 4.3s ease forwards`,L[1].style.animation=`${s}-rotate-${r%2} 4.3s ease forwards`,L[2].style.animation=`${t}-rotate-${r%2} 4.3s ease forwards`,x.play(),n.style.pointerEvents="none",n.innerText="Tossing Coins...",setTimeout(()=>{n.style.pointerEvents="all",n.innerText="Toss Coins",6===r&&(n.value="result",n.innerText="Get Result")},5500);break;case"result":const i=m[c];console.log("Hexagram Result:",i),n.value="reset",n.innerText="New Round",E.innerHTML=i.character,f.innerHTML=`"${i.name}"`,v.innerHTML=`"${i.meaning}"`,setTimeout(()=>{E.className="active",2===i.character.length?E.style.marginRight="1%":E.style.marginRight="3%"},3500),f.style.animation="blurFadeIn 3s ease-in forwards",f.style.fontSize="3rem",f.style.display="block",b.style.display="none",p.style.display="grid",setTimeout(()=>{v.style.display="inline-block"},7500),n.style.pointerEvents="none",setTimeout(()=>{n.style.pointerEvents="all"},11e3);break;case"reset":c=0,r=0,d=1,n.value="start",n.innerText="Start";for(const l of L)l.style.animation="none";E.innerHTML="",v.innerHTML="",f.innerHTML="Instruction",u.innerHTML="Side Info",E.className="inactive",f.style.fontSize="2rem",f.style.animation="none",T.style.display="inline-block",v.style.display="none",p.style.display="inline",u.style.fontSize="2rem",y.style.display="inline-block";for(let e=0;e<6;e++)console.log(g[e]),g[e].innerHTML=""}})});
